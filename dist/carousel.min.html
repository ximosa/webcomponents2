<link rel="import" href="../bower_components/polymer/polymer-element.html"><dom-module id="wc-carousel"><template><style>:host{display:block;position:relative;overflow:hidden;contain:content}:host::after{display:block;content:'';padding-top:75%}::slotted(img){position:absolute;display:block;width:100%;height:100%}::slotted(:not([selected])){display:none}button{position:absolute;top:calc(50% - 20px);padding:0;line-height:40px;border:none;background:0 0;color:#ddd;font-size:40px;font-weight:700;opacity:.7;cursor:pointer}button:focus,button:hover{opacity:1;outline:0}#prevBtn{left:12px}#nextBtn{right:12px}button[disabled]{opacity:.4;cursor:default}</style><slot></slot><button id="prevBtn" on-click="previous">❮</button><button id="nextBtn" on-click="next">❯</button></template><script>var _Mathround=Math.round,_Mathabs=Math.abs;class WcCarousel extends Polymer.Element{static get is(){return'wc-carousel'}static get config(){return{properties:{selected:{type:Object,observer:'_selectedChanged'},infiniteLoop:{type:Boolean},autoPlay:{type:Boolean,observer:'_autoPlayChanged'},interval:{type:Number},direction:{type:String,value:'right'}}}}connectedCallback(){super.connectedCallback(),this.selected=this.firstElementChild,requestAnimationFrame(this._installListeners.bind(this)),this._resetInterval()}previous(){this.moving='prev';const a=this.selected.previousElementSibling;a&&!this._touchDir?this.selected=a:this.infiniteLoop&&!this._touchDir&&(this.selected=this.lastElementChild),this._resetInterval()}next(){this.moving='next';const a=this.selected.nextElementSibling;a&&!this._touchDir?this.selected=a:this.infiniteLoop&&!this._touchDir&&(this.selected=this.firstElementChild),this._resetInterval()}_selectedChanged(a,b){a&&b&&('prev'==this.moving?this._leftTransition(a,b):'next'==this.moving&&this._rightTransition(a,b)),b&&b.removeAttribute('selected'),a&&a.setAttribute('selected','');let c=this.selected.previousElementSibling,d=this.selected.nextElementSibling;this.infiniteLoop&&(!c&&(c=this.lastElementChild),!d&&(d=this.firstElementChild)),this._loadImage(a),this._loadImage(c),this._loadImage(d),this.infiniteLoop||(this.$.prevBtn.disabled=!a.previousElementSibling,this.$.nextBtn.disabled=!a.nextElementSibling)}_autoPlayChanged(a){a?this._resetInterval():this.fninterval&&(clearInterval(this.fninterval),delete this.fninterval)}_resetInterval(){this.fninterval&&(clearInterval(this.fninterval),delete this.fninterval),this.fninterval=setInterval(()=>{'right'==this.direction?this.next():this.previous()},this.interval)}_loadImage(a){a&&!a.src&&(a.src=a.getAttribute('data-src'))}_translateX(a,b,c){a.style.display='block',a.style.transition=c?'transform 0.3s':'',a.style.transform='translate3d('+b+'px, 0, 0)'}_leftTransition(a,b){this._touchDir||(this._translateX(b,0),this._translateX(a,-this.offsetWidth)),this._translateX(b,this.offsetWidth,!0),this._translateX(a,0,!0)}_rightTransition(a,b){this._touchDir||(this._translateX(b,0),this._translateX(a,this.offsetWidth)),this._translateX(b,-this.offsetWidth,!0),this._translateX(a,0,!0)}_installListeners(){this.addEventListener('transitionend',this._resetChildrenStyles.bind(this)),this.addEventListener('touchstart',this._touchstart.bind(this)),this.addEventListener('touchmove',this._touchmove.bind(this)),this.addEventListener('touchend',this._touchend.bind(this))}_resetChildrenStyles(){for(let a=this.firstElementChild;a;)a.style.display='',a.style.transition='',a.style.transform='',a=a.nextElementSibling}_touchstart(a){2>this.childElementCount||(this.fninterval&&(clearInterval(this.fninterval),delete this.fninterval),!this._touchDir&&(this._startX=a.changedTouches[0].clientX,this._startY=a.changedTouches[0].clientY))}_touchmove(a){if(!(2>this.childElementCount)){if(!this._touchDir){const b=_Mathabs(a.changedTouches[0].clientX-this._startX),c=_Mathabs(a.changedTouches[0].clientY-this._startY);this._touchDir=b>c?'x':'y'}if('x'===this._touchDir){a.preventDefault();let b=_Mathround(a.changedTouches[0].clientX-this._startX),c=this.selected.previousElementSibling,d=this.selected.nextElementSibling;this.infiniteLoop&&(!c&&(c=this.lastElementChild),!d&&(d=this.firstElementChild)),(!c&&0<b||!d&&0>b)&&(b=0),this._translateX(this.selected,b),c&&this._translateX(c,b-this.offsetWidth),d&&this._translateX(d,b+this.offsetWidth)}}}_touchend(a){if(!(2>this.childElementCount||a.touches.length)){if(this._resetInterval(),'x'===this._touchDir){let b=_Mathround(a.changedTouches[0].clientX-this._startX),c=this.selected.previousElementSibling,d=this.selected.nextElementSibling;this.infiniteLoop&&(!c&&(c=this.lastElementChild),!d&&(d=this.firstElementChild)),(!c&&0<b||!d&&0>b)&&(b=0),0<b?100<b?(b===this.offsetWidth?this._resetChildrenStyles():(this._translateX(c,0,!0),this._translateX(this.selected,this.offsetWidth,!0)),this.moving='prev',this.selected=c):(this._translateX(c,-this.offsetWidth,!0),this._translateX(this.selected,0,!0)):0>b?-100>b?(b===-this.offsetWidth?this._resetChildrenStyles():(this._translateX(this.selected,-this.offsetWidth,!0),this._translateX(d,0,!0)),this.moving='next',this.selected=d):(this._translateX(this.selected,0,!0),this._translateX(d,this.offsetWidth,!0)):this._resetChildrenStyles()}this._touchDir=null}}}customElements.define(WcCarousel.is,WcCarousel);</script></dom-module>